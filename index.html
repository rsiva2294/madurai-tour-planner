<!doctype html>
<html>
  <head>
    <title>Madurai Multi-Day Itinerary Planner</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="index.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script type="importmap">
      {
        "imports": {
          "@google/genai": "https://esm.sh/@google/genai@^0.7.0"
        }
      }
    </script>
  </head>
  <body data-theme="light">
    <!-- Main container for the map and related UI elements -->
    <div id="app-container">
      <div id="map-container" class="map-container">
        <div id="map"></div>
        <div id="map-loader" class="map-loader hidden">
          <div class="spinner"></div>
        </div>
      </div>

      <!-- Control panel for trip planning (Side panel on desktop, Bottom Sheet on mobile) -->
      <div id="control-panel" class="control-panel">
        <div class="panel-header">
          <h2 class="panel-title">Trip Planner</h2>
          <button id="collapse-panel" class="icon-button" aria-label="Collapse panel">
            <i class="fas fa-chevron-left"></i>
          </button>
        </div>
        <div class="panel-content">
          <div class="trip-inputs">
            <div class="input-group">
              <label for="days-input">Number of Days</label>
              <input
                type="number"
                id="days-input"
                value="2"
                min="1"
                max="10"
                aria-label="Number of days for the trip"
              />
            </div>
            <div class="input-group">
              <label>Select Your Interests</label>
              <div class="poi-chips" id="poi-chips-container">
                <!-- Chips will be inserted here by the script -->
              </div>
            </div>
          </div>
          <div class="action-buttons">
            <button id="generate" class="filled-button">
              <span class="button-text">Generate Itinerary</span>
              <div class="spinner"></div>
            </button>
             <button id="surprise-me-button" class="outlined-button surprise-button">
              <i class="fas fa-magic"></i>
              <span class="button-text">Surprise Me</span>
              <div class="spinner"></div>
            </button>
          </div>
          <div class="error" id="error-message"></div>

          <!-- Map Customization Settings -->
          <div class="map-settings">
            <div class="setting-divider"></div>
            <div class="input-group">
              <label>Map Options</label>
              <div class="setting-row">
                <span>Enable Zoom Controls</span>
                <label class="switch">
                  <input type="checkbox" id="zoom-control-toggle">
                  <span class="slider round"></span>
                </label>
              </div>
              <div class="setting-row">
                <span>Enable Greedy Gestures</span>
                <label class="switch">
                  <input type="checkbox" id="gesture-handling-toggle" checked>
                  <span class="slider round"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- FAB to show the control panel on mobile -->
      <button id="show-controls-button" class="fab primary-fab hidden" aria-label="Plan trip">
        <i class="fas fa-edit"></i>
      </button>

      <!-- FAB to reset the map -->
      <button id="reset" class="fab secondary-fab" aria-label="Reset plan">
        <i class="fas fa-undo"></i>
      </button>

      <!-- FAB to toggle the itinerary carousel view -->
      <button id="toggle-carousel-button" class="fab secondary-fab hidden" aria-label="Toggle itinerary view">
        <i class="fas fa-chevron-down"></i>
      </button>
      
      <!-- Carousel for location details at the bottom -->
      <div id="location-carousel" class="location-carousel hidden">
        <div class="carousel-header">
          <h3 class="carousel-title">Your Itinerary</h3>
          <div class="carousel-actions">
             <div id="route-visibility-control" class="route-visibility-control hidden">
              <button id="route-visibility-toggle-btn" class="text-button">
                <i class="fas fa-route"></i> Routes
              </button>
              <div id="route-visibility-popover" class="route-visibility-popover hidden">
                <div class="popover-header">
                  <h5>Route Visibility</h5>
                </div>
                <div id="day-toggles-container">
                  <!-- Day toggles will be inserted here by the script -->
                </div>
              </div>
            </div>
            <button id="share-plan" class="text-button hidden">
              <i class="fas fa-share-alt"></i> Share
            </button>
            <button id="export-plan" class="text-button hidden">
              <i class="fas fa-download"></i> Export
            </button>
          </div>
        </div>
        <div id="cards-container" class="cards-container">
          <!-- Itinerary day headers and location cards will be dynamically inserted here -->
        </div>
      </div>
    </div>
    
    <!-- Food Category Selection Modal -->
    <div id="food-modal-overlay" class="modal-overlay hidden">
      <div id="food-modal" class="modal">
        <div class="modal-header">
          <h3>Select Food Preferences</h3>
          <button id="close-modal-btn" class="icon-button" aria-label="Close food selection modal"><i class="fas fa-times"></i></button>
        </div>
        <div class="modal-body" id="food-categories-container">
          <!-- Food category checkboxes will be inserted here -->
        </div>
        <div class="modal-footer">
          <button id="cancel-food-selection" class="text-button">Cancel</button>
          <button id="confirm-food-selection" class="filled-button">Confirm</button>
        </div>
      </div>
    </div>

    <!-- Scrim for modal/bottom sheet overlays -->
    <div id="scrim" class="scrim hidden"></div>

    <!-- Third-party library for PDF generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- Set API key for script access -->
    <script>
      window.GOOGLE_MAPS_API_KEY = "AIzaSyCmKPfqghHeL0U5n70xENammTeTl8ngHrw";
    </script>

    <!-- Google Maps JavaScript API script -->
    <script>
      // Script to load the Google Maps JavaScript API asynchronously.
      ((g) => {
        var h,
          a,
          k,
          p = "The Google Maps JavaScript API",
          c = "google",
          l = "importLibrary",
          q = "__ib__",
          m = document,
          b = window;
        b = b[c] || (b[c] = {});
        var d = b.maps || (b.maps = {}),
          r = new Set(),
          e = new URLSearchParams(),
          u = () =>
            h ||
            (h = new Promise(async (f, n) => {
              await (a = m.createElement("script"));
              e.set("libraries", [...r] + "");
              for (k in g)
                e.set(
                  k.replace(/[A-Z]/g, (t) => "_" + t[0].toLowerCase()),
                  g[k],
                );
              e.set("callback", c + ".maps."
+ q);
              a.src = `https://maps.${c}apis.com/maps/api/js?` + e;
              d[q] = f;
              a.onerror = () => (h = n(Error(p + " could not load.")));
              a.nonce = m.querySelector("script[nonce]")?.nonce || "";
              m.head.append(a);
            }));
        d[l]
          ? console.warn(p + " only loads once. Ignoring:", g)
          : (d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)));
      })({ key: "AIzaSyCmKPfqghHeL0U5n70xENammTeTl8ngHrw", v: "weekly", language: "en" });
    </script>
    <script type="module" src="index.tsx"></script>
  </body>
</html>